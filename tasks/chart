# List available commands
[private]
default:
  just --justfile {{justfile()}} --list chart

# Build the Helm chart: lint, update deps, test, and package
build:
  #!/usr/bin/env bash
  set -e
  
  cd {{justfile_directory()}}

  echo "ðŸ”¨ Building Helm chart..."
  echo ""
  
  echo "ðŸ” Linting chart..."
  helm lint ./chart
  echo "âœ“ Lint passed"
  echo ""
  
  echo "ðŸ“¥ Updating dependencies..."
  cd chart
  helm dependency update
  cd ..
  echo "âœ“ Dependencies updated"
  echo ""
  
  echo "ðŸ§ª Testing chart (dry-run)..."
  helm install scaleodm-test ./chart --dry-run --debug > /dev/null
  echo "âœ“ Test passed"
  echo ""
  
  echo "ðŸ“¦ Packaging chart..."
  helm package ./chart
  PACKAGE=$(ls -t scaleodm-*.tgz | head -1)
  echo "âœ“ Chart packaged: $PACKAGE"
  echo ""
  echo "âœ… Build complete!"

# Lint the Helm chart
lint:
  helm lint ./chart

# Package the Helm chart
package:
  #!/usr/bin/env bash
  set -e
  
  cd chart
  helm dependency update
  cd ..
  helm package ./chart
  echo "Package: $(ls -t scaleodm-*.tgz | head -1)"

# Render chart templates
template:
  helm template scaleodm ./chart

# Validate chart templates
validate:
  helm template scaleodm ./chart | kubectl --dry-run=client -f - validate

# Test chart installation (dry-run)
test:
  helm install scaleodm-test ./chart --dry-run --debug

# Show chart information
show:
  helm show all ./chart

# Clean up packaged charts
clean:
  #!/usr/bin/env bash
  set -e
  
  rm -f scaleodm-*.tgz
  rm -rf chart/charts/
  echo "âœ“ Cleaned up chart artifacts"
