# Name override for the chart
nameOverride: ""
fullnameOverride: ""

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

# ScaleODM API configuration
api:
  image:
    repository: ghcr.io/hotosm/scaleodm
    tag: ""
    pullPolicy: IfNotPresent
  
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 31100
    targetPort: 31100
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # Port configuration
  port: 31100
  
  # Security context
  podSecurityContext: {}
  securityContext: {}
  
  # Node selector, tolerations, and affinity
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Database configuration
database:
  # Use an existing Kubernetes Secret for an external database.
  # The secret should contain a key with the full PostgreSQL URI
  # (e.g. postgres://user:password@host:port/database?sslmode=disable).
  external:
    enabled: true
    secret:
      name: "scaleodm-db-vars"
      key: "SCALEODM_DATABASE_URL"
  
  # Optional: Deploy PostgreSQL as a subchart when external.enabled is false.
  # NOTE: This path is mainly for development; for production, prefer an
  # operator-managed or externally provisioned database and external.secret.
  postgres:
    enabled: false
    auth:
      username: scaleodm
      password: ""
      database: scaleodm
    primary:
      persistence:
        enabled: true
        size: 20Gi

# S3 configuration
s3:
  # Use an existing Kubernetes Secret for S3 configuration. This secret
  # should live in the same namespace as ScaleODM and contain some or all
  # of the keys:
  # - SCALEODM_S3_ENDPOINT
  # - SCALEODM_S3_ACCESS_KEY
  # - SCALEODM_S3_SECRET_KEY
  # - SCALEODM_S3_STS_ENDPOINT
  # - SCALEODM_S3_STS_ROLE_ARN
  external:
    enabled: true
    secret:
      name: "scaleodm-s3-vars"
      keys:
        endpoint: "SCALEODM_S3_ENDPOINT"
        accessKey: "SCALEODM_S3_ACCESS_KEY"
        secretKey: "SCALEODM_S3_SECRET_KEY"
        stsEndpoint: "SCALEODM_S3_STS_ENDPOINT"
        stsRoleArn: "SCALEODM_S3_STS_ROLE_ARN"
  
  # Optional: Deploy MinIO as a subchart when external.enabled is false.
  minio:
    enabled: false
    # MinIO subchart values (if enabled)
    auth:
      rootUser: ""
      rootPassword: ""
    persistence:
      enabled: true
      size: 100Gi

# Kubernetes configuration
kubernetes:
  # Namespace for Argo Workflows
  namespace: argo
  
  # ServiceAccount configuration
  serviceAccount:
    create: true
    name: ""
    annotations: {}
  
  # RBAC configuration
  rbac:
    create: true
    # Role permissions needed for Argo Workflows
    # The service account needs permissions to create/list/watch workflows

# Configuration (non-sensitive)
config:
  # ODM image to use in workflows
  odmImage: "docker.io/opendronemap/odm:3.5.6"
  
  # Cluster URL (used for federation)
  clusterUrl: ""
  
  # Enqueue test jobs (for testing)
  enqueueTestJobs: "false"

# Argo Workflows subchart configuration
argo:
  enabled: true
  # Argo Workflows will be deployed as a subchart if enabled
  # If disabled, ensure Argo Workflows is already installed in the cluster
  
  # Common Argo Workflows values
  server:
    enabled: true
    service:
      type: ClusterIP
  
  controller:
    enabled: true
    # Parallelism configuration to prevent overwhelming worker nodes
    # This limits the total number of workflows that can run concurrently
    # across the entire cluster. Recommended: (number of worker nodes) * 2-3
    # For example: 3 worker nodes = 6-9 concurrent workflows
    # Set to 0 to disable the limit (not recommended for production)
    parallelism: 10
  
  # Namespace for Argo Workflows (should match kubernetes.namespace)
  namespace: argo

# Ingress configuration (optional)
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: scaleodm.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

